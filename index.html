<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜¥èŠ‚è¯æ±‡å¤§æŒ‘æˆ˜ (ç»ˆæè¶£å‘³ç‰ˆ)</title>
    <style>
        :root {
            --color-red: #e74c3c;
            --color-yellow: #f1c40f;
            --color-blue: #3498db;
            --color-green: #2ecc71;
            --color-bg-light: #f8f9fa;
            --color-bg-accent: #ffeaa7;
        }
        body {
            font-family: 'Comic Sans MS', 'å¾®è½¯é›…é»‘', 'Heiti TC', sans-serif;
            background: linear-gradient(135deg, #ffccd5, #c2e9fb);
            text-align: center;
            padding: 20px;
            min-height: 100vh;
            margin: 0;
            color: #333;
            overflow-x: hidden;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.97);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        h1 {
            color: var(--color-red);
            text-shadow: 3px 3px 0 #ffd700;
            font-size: 3em;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }
        .subtitle {
            color: #666;
            font-size: 1.3em;
            margin-bottom: 30px;
        }
        .level-nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        .level-btn {
            background: linear-gradient(45deg, var(--color-blue), #2980b9);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }
        .level-btn:hover, .level-btn.active {
            transform: scale(1.1) translateY(-3px);
            background: linear-gradient(45deg, var(--color-red), #c0392b);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);
        }
        .game-panel {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        .game-panel.active {
            display: block;
        }
        .game-header {
            background: var(--color-bg-light);
            padding: 15px 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 3px dashed var(--color-blue);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .timer-display {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--color-red);
            text-shadow: 1px 1px 0 #fff;
        }
        .game-btn {
            background: linear-gradient(45deg, var(--color-red), #c0392b);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.3em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.2);
            font-family: inherit;
        }
        .game-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.3);
        }
        .game-area {
            display: flex;
            gap: 25px;
            margin-bottom: 30px;
            min-height: 400px;
            perspective: 1000px; /* Enable 3D space for cards */
        }
        .word-pool, .target-area, .xiaoXiaoLe-area {
            flex: 1;
            border-radius: 20px;
            padding: 25px;
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            gap: 20px;
            justify-content: center;
            position: relative;
        }
        .word-pool {
            background: #f1f8e9;
            border: 3px dashed var(--color-green);
        }
        .target-area {
            background: var(--color-bg-accent);
            border: 3px solid #fdcb6e;
        }
        .xiaoXiaoLe-area {
            background: #e3f2fd;
            border: 3px solid var(--color-blue);
        }
        .word-card, .xiaoXiaoLe-card {
            padding: 20px 25px;
            border-radius: 15px;
            font-size: 1.6em;
            font-weight: bold;
            cursor: grab;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 3px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            min-width: 120px;
            user-select: none;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .word-<|card|>:hover, .xiaoXiaoLe-<|card|>:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        .word-<|card|>:active, .xiaoXiaoLe-<|card|>:active {
            cursor: grabbing;
            transform: scale(0.98);
        }
        .xiaoXiaoLe-card.verb {
            background: linear-gradient(45deg, var(--color-blue), #2980b9);
        }
        .xiaoXiaoLe-card.noun {
            background: linear-gradient(45deg, var(--color-yellow), #f39c12);
        }
        .xiaoXiaoLe-card.selected {
            border-color: #ffeb3b;
            box-shadow: 0 0 20px #ffeb3b;
            transform: scale(1.1);
        }
        .xiaoXiaoLe-card.correct {
            animation: correctPair 0.8s ease-out forwards;
        }
        .feedback-area {
            background: var(--color-bg-light);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid #b2bec3;
            font-size: 1.5em;
            font-weight: bold;
            transition: all 0.3s ease;
            text-shadow: 1px 1px 0 #fff;
        }
        .feedback-area.correct {
            color: var(--color-green);
            border-color: var(--color-green);
            background-color: #e8f5e9;
        }
        .feedback-area.wrong {
            color: var(--color-red);
            border-color: var(--color-red);
            background-color: #ffebee;
        }
        .pinyin {
            display: block;
            font-size: 0.7em;
            font-weight: normal;
            margin-top: 5px;
            opacity: 0.9;
        }
        .drop-hint {
            font-size: 1.3em;
            color: #666;
            pointer-events: none;
        }
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
            animation: fall 5s linear infinite;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes correctPair {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.8; }
            100% { transform: scale(0); opacity: 0; }
        }
        @keyframes fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŠ æ˜¥èŠ‚è¯æ±‡å¤§æŒ‘æˆ˜ ğŸ¯</h1>
        <p class="subtitle">è¾¹ç©è¾¹å­¦ï¼Œæˆä¸ºæ˜¥èŠ‚å°è¾¾äººï¼</p>

        <div class="level-nav">
            <button class="level-btn active" onclick="switchLevel(1)">ç¬¬1å…³ï¼šå¬éŸ³è¯†è¯</button>
            <button class="level-btn" onclick="switchLevel(2)">ç¬¬2å…³ï¼šè¯è¯­ç¢°ç¢°æ¶ˆ</button>
        </div>

        <!-- ç¬¬ä¸€å…³ï¼šå¬éŸ³è¯†è¯ -->
        <div id="level1" class="game-panel active">
            <div class="game-header">
                <div>
                    <button class="game-btn" id="playSound1">ğŸ”Š æ’­æ”¾å£°éŸ³</button>
                    <button class="game-btn" id="resetLevel1">ğŸ”„ é‡æ–°å¼€å§‹</button>
                </div>
                <div id="currentPhrase1" class="timer-display">å‡†å¤‡å¼€å§‹ï¼</div>
            </div>
            <div class="game-area">
                <div class="word-pool" id="wordPool1">
                    <!-- è¯è¯­å¡ç‰‡ä¼šåœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="target-area" id="targetBox1">
                    <div class="drop-hint">ğŸ æŠŠå¬åˆ°çš„è¯æ‹–åˆ°è¿™é‡Œ ğŸ</div>
                </div>
            </div>
            <div class="feedback-area" id="feedback1">ç‚¹å‡»â€œæ’­æ”¾å£°éŸ³â€æŒ‰é’®å¼€å§‹æ¸¸æˆï¼</div>
        </div>

        <!-- ç¬¬äºŒå…³ï¼šè¯è¯­ç¢°ç¢°æ¶ˆ -->
        <div id="level2" class="game-panel">
            <div class="game-header">
                <div>
                    <button class="game-btn" id="startLevel2">â–¶ï¸ å¼€å§‹æŒ‘æˆ˜</button>
                    <button class="game-btn" id="resetLevel2">ğŸ”„ é‡æ–°å¼€å§‹</button>
                </div>
                <div class="timer-display">â±ï¸ <span id="timer">00:00</span></div>
            </div>
            <div class="game-area">
                <div class="xiaoXiaoLe-area" id="xiaoXiaoLeGrid">
                    <div class="drop-hint">ç‚¹å‡»â€œå¼€å§‹æŒ‘æˆ˜â€æŒ‰é’®å¼€å§‹æ¸¸æˆï¼</div>
                </div>
            </div>
            <div class="feedback-area" id="feedback2">é…å¯¹æˆåŠŸå°±èƒ½æ¶ˆé™¤ï¼Œçœ‹çœ‹ä½ æœ‰å¤šå¿«ï¼</div>
        </div>
    </div>

    <!-- éŸ³æ•ˆèµ„æº -->
    <audio id="correctSound" src="https://www.soundjay.com/button/sounds/applause-1.mp3" preload="auto"></audio> <!-- é¼“æŒ -->
    <audio id="wrongSound" src="https://www.soundjay.com/button/sounds/beep-03.wav" preload="auto"> <!-- é”™è¯¯æç¤ºéŸ³ -->
    <audio id="nextLevelSound" src="https://www.soundjay.com/button/sounds/success-1-92032.mp3" preload="auto"> <!-- ä¸‹ä¸€å…³æç¤ºéŸ³ -->
    <audio id="gameStartSound" src="https://www.soundjay.com/button/sounds/game-start-610.mp3" preload="auto"> <!-- æ¸¸æˆå¼€å§‹ -->

    <script>
        // æ ¸å¿ƒè¯æ±‡åº“ (ç²¾ç®€ç‰ˆï¼Œåªä¿ç•™æ–°å¹´ç›¸å…³)
        const corePhrases = [
            { text: "è¿‡æ–°å¹´", pinyin: "guÃ² xÄ«n niÃ¡n", verb: "è¿‡", noun: "æ–°å¹´" },
            { text: "è´´æ˜¥è”", pinyin: "tiÄ“ chÅ«n liÃ¡n", verb: "è´´", noun: "æ˜¥è”" },
            { text: "åƒé¥ºå­", pinyin: "chÄ« jiÇo zi", verb: "åƒ", noun: "é¥ºå­" },
            { text: "çœ‹æ˜¥æ™š", pinyin: "kÃ n chÅ«n wÇn", verb: "çœ‹", noun: "æ˜¥æ™š" },
            { text: "æ”¾é­ç‚®", pinyin: "fÃ ng biÄn pÃ o", verb: "æ”¾", noun: "é­ç‚®" }
        ];
        const verbNounPairs = {
            "è¿‡": ["æ–°å¹´"],
            "è´´": ["æ˜¥è”"],
            "åƒ": ["é¥ºå­"],
            "çœ‹": ["æ˜¥æ™š"],
            "æ”¾": ["é­ç‚®"]
        };

        // DOMå…ƒç´ 
        // é€šç”¨
        const correctSound = document.getElementById("correctSound");
        const wrongSound = document.getElementById("wrongSound");
        const nextLevelSound = document.getElementById("nextLevelSound");
        const gameStartSound = document.getElementById("gameStartSound");
        // ç¬¬ä¸€å…³
        const playSound1Btn = document.getElementById("playSound1");
        const resetLevel1Btn = document.getElementById("resetLevel1");
        const currentPhrase1Div = document.getElementById("currentPhrase1");
        const wordPool1Element = document.getElementById("wordPool1");
        const targetBox1Element = document.getElementById("targetBox1");
        const feedback1Element = document.getElementById("feedback1");
        // ç¬¬äºŒå…³
        const startLevel2Btn = document.getElementById("startLevel2");
        const resetLevel2Btn = document.getElementById("resetLevel2");
        const timerElement = document.getElementById("timer");
        const xiaoXiaoLeGridElement = document.getElementById("xiaoXiaoLeGrid");
        const feedback2Element = document.getElementById("feedback2");

        // å…¨å±€å˜é‡
        let currentTargetPhrase = "";
        let selectedCardId = null;
        let gameTimerInterval;
        let startTime;
        let isGameActive = false;

        // --- é€šç”¨å‡½æ•° ---
        function speakText(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'zh-CN';
                utterance.rate = 0.9;
                window.speechSynthesis.speak(utterance);
            }
        }
        function playSound(soundElement) {
            soundElement.currentTime = 0;
            soundElement.play().catch(e => console.log("Audio playback failed:", e));
        }
        function getRandomColorPair() {
            const pairs = [
                { primary: '#FF6B6B', secondary: '#FF8E8E' }, { primary: '#4ECDC4', secondary: '#6BF5D8' },
                { primary: '#45B7D1', secondary: '#96E6FF' }, { primary: '#FFBE0B', secondary: '#FFD166' },
                { primary: '#6A0572', secondary: '#9D4EDD' }, { primary: '#118AB2', secondary: '#06D6A0' }
            ];
            return pairs[Math.floor(Math.random() * pairs.length)];
        }
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        function createConfetti() {
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = Math.random() * 10 + 5 + 'px';
                confetti.style.animationDuration = Math.random() * 3 + 2 + 's';
                document.body.appendChild(confetti);
                setTimeout(() => {
                    document.body.removeChild(confetti);
                }, 5000);
            }
        }

        // --- å…³å¡åˆ‡æ¢ ---
        function switchLevel(levelNum) {
            document.querySelectorAll('.game-panel').forEach(panel => panel.classList.remove('active'));
            document.querySelectorAll('.level-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`level${levelNum}`).classList.add('active');
            document.querySelector(`.level-btn[onclick="switchLevel(${levelNum})"]`).classList.add('active');
            
            if (levelNum === 1) {
                initLevel1();
            } else if (levelNum === 2) {
                initLevel2();
            }
        }
        
        // --- ç¬¬ä¸€å…³ï¼šå¬éŸ³è¯†è¯ ---
        function initLevel1() {
            clearInterval(gameTimerInterval);
            currentTargetPhrase = "";
            wordPool1Element.innerHTML = '';
            targetBox1Element.innerHTML = '<div class="drop-hint">ğŸ æŠŠå¬åˆ°çš„è¯æ‹–åˆ°è¿™é‡Œ ğŸ</div>';
            currentPhrase1Div.textContent = "å‡†å¤‡å¼€å§‹ï¼";
            feedback1Element.textContent = "ç‚¹å‡»â€œæ’­æ”¾å£°éŸ³â€æŒ‰é’®å¼€å§‹æ¸¸æˆï¼";
            feedback1Element.className = "feedback-area";

            const shuffledPhrases = shuffleArray([...corePhrases]);
            
            shuffledPhrases.forEach((phrase, index) => {
                const wordCard = document.createElement('div');
                const colors = getRandomColorPair();
                wordCard.className = 'word-card';
                wordCard.style.background = `linear-gradient(45deg, ${colors.primary}, ${colors.secondary})`;
                wordCard.id = `level1-card-${index}`;
                wordCard.draggable = true;
                wordCard.innerHTML = `${phrase.text}<span class="pinyin">${phrase.pinyin}</span>`;
                wordCard.setAttribute('data-phrase', phrase.text);
                
                wordCard.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', wordCard.id);
                    wordCard.style.opacity = '0.6';
                });
                wordCard.addEventListener('dragend', () => {
                    wordCard.style.opacity = '1';
                });

                wordPool1Element.appendChild(wordCard);
            });

            targetBox1Element.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                targetBox1Element.style.background = '#fff3e0';
            });
            targetBox1Element.addEventListener('dragleave', () => {
                targetBox1Element.style.background = 'var(--color-bg-accent)';
            });
            targetBox1Element.addEventListener('drop', handleLevel1Drop);
        }
        function playRandomPhrase() {
            const remainingCards = Array.from(wordPool1Element.children).filter(card => card.parentElement === wordPool1Element);
            if (remainingCards.length === 0) {
                feedback1Element.textContent = "ğŸ‰ æ­å–œä½ ï¼ç¬¬ä¸€å…³æ»¡åˆ†é€šå…³ï¼";
                feedback1Element.className = "feedback-area correct";
                playSound(nextLevelSound);
                currentPhrase1Div.textContent = "å¤ªæ£’äº†ï¼";
                setTimeout(() => {
                    if(confirm("å¤ªæ£’äº†ï¼è¦ä¸è¦æŒ‘æˆ˜æ›´åˆºæ¿€çš„ç¬¬äºŒå…³ï¼Ÿ")) {
                        switchLevel(2);
                    }
                }, 1500);
                return;
            }

            const randomIndex = Math.floor(Math.random() * remainingCards.length);
            const randomCard = remainingCards[randomIndex];
            currentTargetPhrase = randomCard.getAttribute('data-phrase');
            
            currentPhrase1Div.textContent = `å¬å£°éŸ³æ‰¾å‡º: ${currentTargetPhrase}`;
            speakText(currentTargetPhrase);
            
            feedback1Element.textContent = `æ­£åœ¨æ’­æ”¾: ${currentTargetPhrase}`;
            feedback1Element.className = "feedback-area";
            
            playSound1Btn.textContent = "ğŸ”Š å†å¬ä¸€é";
            setTimeout(() => { playSound1Btn.textContent = "ğŸ”Š æ’­æ”¾å£°éŸ³"; }, 1500);
        }
        function handleLevel1Drop(e) {
            e.preventDefault();
            targetBox1Element.style.background = 'var(--color-bg-accent)';
            const cardId = e.dataTransfer.getData('text/plain');
            const draggedCard = document.getElementById(cardId);

            if (!draggedCard || !currentTargetPhrase) return;

            const draggedPhrase = draggedCard.getAttribute('data-phrase');
            
            if (draggedPhrase === currentTargetPhrase) {
                feedback1Element.textContent = `âœ… æ­£ç¡®ï¼å°±æ˜¯${draggedPhrase}ï¼`;
                feedback1Element.className = "feedback-area correct";
                playSound(correctSound);
                
                targetBox1Element.appendChild(draggedCard);
                draggedCard.draggable = false;
                draggedCard.style.cursor = 'default';
                draggedCard.style.width = '100%';
                
                setTimeout(() => {
                    playRandomPhrase();
                    feedback1Element.textContent = "å‡†å¤‡å¬ä¸‹ä¸€ä¸ªè¯...";
                    feedback1Element.className = "feedback-area";
                }, 1500);
                
            } else {
                feedback1Element.textContent = `âŒ ä¸å¯¹å“¦ï¼Œå†è¯•è¯•ï¼`;
                feedback1Element.className = "feedback-area wrong";
                playSound(wrongSound);
                speakText("åŠ æ²¹ï¼Œå†æ¥ä¸€æ¬¡ï¼");
            }
        }

        // --- ç¬¬äºŒå…³ï¼šè¯è¯­ç¢°ç¢°æ¶ˆ (åŠ¨è¯å¾ªç¯ç‰ˆ) ---
        function initLevel2() {
            clearInterval(gameTimerInterval);
            isGameActive = false;
            selectedCardId = null;
            xiaoXiaoLeGridElement.innerHTML = '<div class="drop-hint">ç‚¹å‡»â€œå¼€å§‹æŒ‘æˆ˜â€æŒ‰é’®å¼€å§‹æ¸¸æˆï¼</div>';
            feedback2Element.textContent = "é…å¯¹æˆåŠŸå°±èƒ½æ¶ˆé™¤ï¼Œçœ‹çœ‹ä½ æœ‰å¤šå¿«ï¼";
            feedback2Element.className = "feedback-area";
            timerElement.textContent = "00:00";
            startLevel2Btn.style.display = "inline-block";
        }
        function startLevel2Game() {
            isGameActive = true;
            startLevel2Btn.style.display = "none";
            xiaoXiaoLeGridElement.innerHTML = '';
            feedback2Element.textContent = "æ¸¸æˆå¼€å§‹ï¼å¿«é€Ÿé…å¯¹å§ï¼";
            feedback2Element.className = "feedback-area";
            
            // åˆå§‹åŒ–åè¯å¡ç‰‡
            const allNouns = [];
            Object.values(verbNounPairs).forEach(nouns => nouns.forEach(noun => allNouns.push(noun)));
            shuffleArray(allNouns).forEach((noun, index) => {
                const card = createXiaoXiaoLeCard(noun, 'noun', index);
                xiaoXiaoLeGridElement.appendChild(card);
            });

            // åˆå§‹åŒ–åŠ¨è¯å¡ç‰‡ (æ¯ç§ä¸€ä¸ª)
            const initialVerbs = shuffleArray(Object.keys(verbNounPairs)).slice(0, 3); // Start with 3 verbs
            initialVerbs.forEach((verb, index) => {
                const card = createXiaoXiaoLeCard(verb, 'verb', index + allNouns.length);
                xiaoXiaoLeGridElement.appendChild(card);
            });
            
            // å¼€å§‹è®¡æ—¶
            startTime = Date.now();
            gameTimerInterval = setInterval(() => {
                const elapsedTime = Math.floor((Date.now() - startTime) / 1000);
                timerElement.textContent = formatTime(elapsedTime);
            }, 1000);
            
            playSound(gameStartSound);
        }
        function createXiaoXiaoLeCard(text, type, id) {
            const card = document.createElement('div');
            card.className = `xiaoXiaoLe-card ${type}`;
            card.id = `xxl-card-${id}`;
            card.innerHTML = text;
            card.setAttribute('data-text', text);
            card.setAttribute('data-type', type);
            card.addEventListener('click', () => handleXiaoXiaoLeClick(card));
            return card;
        }
        function handleXiaoXiaoLeClick(card) {
            if (!isGameActive || card.classList.contains('correct')) return;

            if (selectedCardId) {
                const firstCard = document.getElementById(selectedCardId);
                
                if (selectedCardId === card.id) { // ç‚¹å‡»åŒä¸€å¡ç‰‡å–æ¶ˆé€‰æ‹©
                    firstCard.classList.remove('selected');
                    selectedCardId = null;
                    feedback2Element.textContent = "å·²å–æ¶ˆé€‰æ‹©ã€‚";
                    return;
                }

                const firstIsVerb = firstCard.getAttribute('data-type') === 'verb';
                const secondIsVerb = card.getAttribute('data-type') === 'verb';

                if (firstIsVerb && !secondIsVerb) {
                    // åŠ¨è¯ + åè¯
                    const verb = firstCard.getAttribute('data-text');
                    const noun = card.getAttribute('data-text');

                    if (verbNounPairs[verb] && verbNounPairs[verb].includes(noun)) {
                        // é…å¯¹æˆåŠŸ
                        firstCard.classList.add('correct');
                        card.classList.add('correct');
                        
                        const phraseText = `${verb}${noun}`;
                        feedback2Element.textContent = `ğŸ‰ ${phraseText}!`;
                        feedback2Element.className = "feedback-area correct";
                        playSound(correctSound);
                        speakText(phraseText);

                        // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ (æ‰€æœ‰åè¯éƒ½è¢«æ¶ˆé™¤)
                        const remainingNouns = Array.from(xiaoXiaoLeGridElement.children).filter(c => c.getAttribute('data-type') === 'noun' && !c.classList.contains('correct'));
                        if (remainingNouns.length === 0) {
                            setTimeout(() => {
                                clearInterval(gameTimerInterval);
                                feedback2Element.textContent = `ğŸŠ æ­å–œï¼ä½ èµ¢äº†ï¼ç”¨æ—¶: ${timerElement.textContent}`;
                                createConfetti();
                                playSound(nextLevelSound);
                            }, 1000);
                            return;
                        }

                        // å»¶è¿Ÿåç§»é™¤å¡ç‰‡ï¼Œå¹¶è¡¥å……ä¸€ä¸ªæ–°çš„éšæœºåŠ¨è¯
                        setTimeout(() => {
                            xiaoXiaoLeGridElement.removeChild(firstCard);
                            xiaoXiaoLeGridElement.removeChild(card);

                            // è¡¥å……åŠ¨è¯
                            const availableVerbs = Object.keys(verbNounPairs).filter(v => {
                                // æ‰¾åˆ°è¿˜æœ‰æœªé…å¯¹åè¯çš„åŠ¨è¯
                                return verbNounPairs[v].some(n => {
                                    return Array.from(xiaoXiaoLeGridElement.children).some(c => c.getAttribute('data-type') === 'noun' && c.getAttribute('data-text') === n && !c.classList.contains('correct'));
                                });
                            });
                            
                            if (availableVerbs.length > 0) {
                                const newVerb = shuffleArray(availableVerbs)[0];
                                const newVerbCard = createXiaoXiaoLeCard(newVerb, 'verb', Date.now()); // unique id
                                xiaoXiaoLeGridElement.appendChild(newVerbCard);
                            }

                        }, 800);

                    } else {
                        // é…å¯¹å¤±è´¥
                        firstCard.classList.remove('selected');
                        card.style.animation = 'shake 0.5s';
                        feedback2Element.textContent = "âŒ é…å¯¹å¤±è´¥ï¼";
                        feedback2Element.className = "feedback-area wrong";
                        playSound(wrongSound);
                    }
                } else {
                    // ä¸¤æ¬¡éƒ½ç‚¹äº†åè¯æˆ–åŠ¨è¯
                    firstCard.classList.remove('selected');
                    feedback2Element.textContent = "âŒ è¯·é€‰æ‹©ä¸€ä¸ªåŠ¨è¯å’Œä¸€ä¸ªåè¯ï¼";
                    feedback2Element.className = "feedback-area wrong";
                    playSound(wrongSound);
                }
                selectedCardId = null; // é‡ç½®é€‰æ‹©
            } else {
                // ç¬¬ä¸€æ¬¡ç‚¹å‡»
                if (card.getAttribute('data-type') === 'verb') {
                    selectedCardId = card.id;
                    card.classList.add('selected');
                    feedback2Element.textContent = `å·²é€‰æ‹©â€œ${card.getAttribute('data-text')}â€ï¼Œå¯»æ‰¾å®ƒçš„åè¯ä¼™ä¼´ï¼`;
                } else {
                    feedback2Element.textContent = "âŒ è¯·å…ˆé€‰æ‹©ä¸€ä¸ªåŠ¨è¯ï¼";
                    feedback2Element.className = "feedback-area wrong";
                    playSound(wrongSound);
                }
            }
        }

        // --- äº‹ä»¶ç›‘å¬åˆå§‹åŒ– ---
        document.addEventListener('DOMContentLoaded', () => {
            // ç¬¬ä¸€å…³
            initLevel1();
            playSound1Btn.addEventListener('click', playRandomPhrase);
            resetLevel1Btn.addEventListener('click', initLevel1);
            
            // ç¬¬äºŒå…³
            initLevel2();
            startLevel2Btn.addEventListener('click', startLevel2Game);
            resetLevel2Btn.addEventListener('click', initLevel2);
        });
    </script>
</body>
</html>